# .github/workflows/pullquest-form.yml
name: PullQuest – serve “Form” on demand

on:
  issue_comment:
    types: [created]          # only new comments

jobs:
  respond_with_form:
    # ① Only run if the comment is on a PR
    # ② … and the body, after trimming white-space, starts with @pullquestai form
    if: |
      github.event.issue.pull_request &&
      startsWith(
        toLower(trim(github.event.comment.body)),
        '@pullquestai form'
      )
    runs-on: ubuntu-latest
    permissions:
      issues: write            # needed for PR comments (they’re “issue” objects)

    steps:
      - name: Debug – show raw comment body
        run: |
          echo "RAW BODY >>>"
          echo "${{ github.event.comment.body }}"
          echo "<<<"

      - name: Post the form
        uses: peter-evans/create-or-update-comment@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          issue-number: ${{ github.event.issue.number }}
          body: |
            ### 📝 PullQuest AI Form  
            Hi @${{ github.event.comment.user.login }} – please fill this out:

            | Field | Details |
            |---|---|
            | **Context** | _What does this PR do?_ |
            | **Areas of concern** | _Specific files or behaviours to focus on?_ |
            | **Preferred review style** | _Quick issues_, _deep dive_, _performance tips_, … |

            When ready, comment **`@pullquestai review`** to trigger an AI review. 🚀
