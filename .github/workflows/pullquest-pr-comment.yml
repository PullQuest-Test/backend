# .github/workflows/pullquest-pr-comment.yml
name: PullQuest â€“ comment on new PRs

on:
  pull_request:
    types: [opened, reopened, ready_for_review]
    branches: [main]        
jobs:
  notify-pullquest:

    permissions:
      contents: read        
      pull-requests: read

    runs-on: ubuntu-latest

    env:
      BACKEND_URL: https://pullquestgithubbackend.onrender.com

    steps:
      - name: Build payload âžœ POST to backend
        run: |
          # numeric PR number
          NUMBER=${{ github.event.pull_request.number }}

          # JSON array of label names
          LABELS=$(jq '.pull_request.labels | map(.name)' "$GITHUB_EVENT_PATH")

          # Assemble payload { owner, repo, prNumber, labels }
          payload=$(jq -n \
            --arg owner  "${{ github.event.repository.owner.login }}" \
            --arg repo   "${{ github.event.repository.name }}" \
            --argjson prNumber "$NUMBER" \
            --argjson labels   "$LABELS" \
            '{owner:$owner, repo:$repo, prNumber:$prNumber, labels:$labels}')

          echo "ðŸ“¦ Payload:"
          echo "$payload"

          curl --fail --show-error --silent \
               -X POST "$BACKEND_URL/api/comment/PullRequest" \
               -H "Content-Type: application/json" \
               --data-raw "$payload"

      - name: Done
        run: echo "âœ… PullQuest notified successfully"
