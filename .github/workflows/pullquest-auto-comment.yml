# .github/workflows/pullquest-auto-comment.yml
name: PullQuest ‚Äì comment on new issues

on:
  issues:
    types: [opened]

jobs:
  notify-pullquest:
    runs-on: ubuntu-latest

    permissions:
      issues: write

    env:
      PULLQUEST_BACKEND_URL: https://pullquestgithubbackend.onrender.com
      PULLQUEST_API_KEY:     "PullQuest-Testk9keu6"

    steps:
      - name: Show context
        run: |
          echo "üîç Repository: ${{ github.repository }}"
          echo "üîç Issue #:    ${{ github.event.issue.number }}"
          echo "üîç Labels:     ${{ toJson(github.event.issue.labels.*.name) }}"

      - name: Notify PullQuest backend
        run: |
          curl --fail --show-error -X POST "$PULLQUEST_BACKEND_URL/api/comment/issues" \
            -H "Authorization: Bearer $PULLQUEST_API_KEY" \
            -H "Content-Type: application/json" \
            -d @- <<'JSON'
          {
            "repo":         "${{ github.repository }}",
            "issue_number": ${{ github.event.issue.number }},
            "issue_url":    "${{ github.event.issue.html_url }}",
            "labels":       ${{ toJson(github.event.issue.labels.*.name) }}
          }
          JSON

      - name: Done
        run: echo "‚úÖ PullQuest notified successfully"
